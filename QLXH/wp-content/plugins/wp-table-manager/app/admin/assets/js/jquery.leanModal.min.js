// leanModal v1.1 by Ray Stone - http://finelysliced.com.au
// Dual licensed under the MIT and GPL

(function ($) {
    $.fn.extend({
        wptm_leanModal: function (options) {
            var defaults = {top: 100, overlay: 0.5, closeButton: null, background: '#ffffff'};
            if ($("#lean_overlay").length == 0) {
                $("body").append("<div id='lean_overlay'></div>");
            }
            ;options = $.extend(defaults, options);
            return this.each(function () {
                var o = options;
                $(this).click(function (e) {
                    var modal_id = $(this).attr("href");
                    if (typeof o.beforeShow == 'function') {
                        o.beforeShow();
                    }
                    $("#lean_overlay").click(function () {
                        close_modal(modal_id)
                    });
                    $(o.closeButton).click(function () {
                        close_modal(modal_id)
                    });
                    var modal_height = $(modal_id).outerHeight();
                    var modal_width = $(modal_id).outerWidth();
                    $("#lean_overlay").css({"display": "block", opacity: 0});
                    $("#lean_overlay").fadeTo(200, o.overlay);
                    if (typeof options.beforeInit == 'function') {
                        options.beforeInit();
                    }
                    $(modal_id).css({
                        "visibility": "visible",
                        "display": "block",
                        "text-align": "center",
                        "position": "fixed",
                        "opacity": 0,
                        "z-index": 100102,
                        "left": !o.left ? 50 + "%" : o.left,
                        "margin-left": !o.marginLeft ? -(modal_width / 2) + "px" : o.marginLeft,
                        "top": o.top + "px",
                        "background": o.background,
                    });
                    $(modal_id).fadeTo(200, 1, function () {
                        if (typeof options.modalShow == 'function') {
                            options.modalShow();
                        }
                    });
                    e.preventDefault()
                })
            });

            function close_modal(modal_id) {
                if (typeof options.before_colose_modal == 'function') {
                    options.before_colose_modal();
                }
                $("#lean_overlay").fadeOut(200);
                $(modal_id).css({"display": "none"})
            }
        },
    })
})(jQuery);
