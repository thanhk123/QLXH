"use strict";(function(a){function b(b){let c=a.Deferred();const d=450,e=window.top.outerHeight/2+window.top.screenY-300,f=window.top.outerWidth/2+window.top.screenX-d/2;let g=window.open(b,"_blank",`width=${d}, height=${600}, top=${e}, left=${f}`),h=window.setInterval(function(){try{let a=g.document.URL;if(-1!==a.indexOf("code"))return window.clearInterval(h),g.close(),void c.resolve(a);if(-1!==a.indexOf("error"))return window.clearInterval(h),g.close(),void c.reject()}catch(a){}g.closed&&(window.clearInterval(h),c.reject())},100);return c}function c(a,b){b=b.replace(/[[]/,"[").replace(/[]]/,"]");let c="[?&]"+b+"=([^&#]*)",d=new RegExp(c),e=d.exec(a);return decodeURIComponent(e[1])}function d(b,c,d,e,f,g){return a.ajax({url:ajaxurl,type:"post",dataType:"json",data:{action:b,source:c,client_id:d,client_secret:e,code:f,accounts_server:g}})}function f(b){b.removeClass("success error").addClass("loading"),a("i",b).removeClass("fa-check fa-close").addClass("fa-spin")}function g(b){b.removeClass("loading success").addClass("success"),a("i",b).removeClass("fa-refresh fa-spin fa-close").addClass("fa-check").css("color","green")}function h(b){b.removeClass("loading success").addClass("error"),a("i",b).removeClass("fa-refresh fa-spin fa-check").addClass("fa-close").css("color","red")}function i(a){return new Promise(b=>{let c=document.querySelector(a);c&&b(c),new MutationObserver((c,d)=>{Array.from(document.querySelectorAll(a)).forEach(a=>{b(a),d.disconnect()})}).observe(document.documentElement,{childList:!0,subtree:!0})})}function j(b,c){let d=a.Deferred();if(b.has("option").length)return d.reject();if(s.modules)return d.resolve(s.modules);if("custom"===c&&""===u){let a=o.settings.attributes;if(""===a.ap_zoho_crm_client_id&&""===a.ap_zoho_crm_client_secret)return d.reject();u=JSON.stringify({form_id:q,post_id:p,expires_in:a.ap_zoho_crm_expires_in,client_id:a.ap_zoho_crm_client_id,client_secret:a.ap_zoho_crm_client_secret,access_token:a.ap_zoho_crm_access_token,refresh_token:a.ap_zoho_crm_refresh_token,accounts_server:a.ap_zoho_crm_accounts_server,api_domain:a.ap_zoho_crm_api_domain})}return a.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"ap_zoho_crm_get_module_names",source:c,customApiData:u},beforeSend:function(){b.parent().before("<i class=\"eicon-spinner eicon-animation-spin\"></i>")},success:function(a){return s.modules=a.data,b.parent().prev().remove(),d.resolve(a.data)}}),d.promise()}function k(b,c,d){let e=a.Deferred();if(b.has("option").length)return e.reject();if(s.fields)return e.resolve(s.fields);if("custom"===c&&""===u){let a=o.settings.attributes;u=JSON.stringify({form_id:q,post_id:p,expires_in:a.ap_zoho_crm_expires_in,client_id:a.ap_zoho_crm_client_id,client_secret:a.ap_zoho_crm_client_secret,access_token:a.ap_zoho_crm_access_token,refresh_token:a.ap_zoho_crm_refresh_token,accounts_server:a.ap_zoho_crm_accounts_server,api_domain:a.ap_zoho_crm_api_domain})}return a.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"ap_zoho_crm_get_module_fields",source:c,module:d,customApiData:u},beforeSend:function(){b.parent().before("<i class=\"eicon-spinner eicon-animation-spin\"></i>")},success:function(a){return s.fields=a.data,b.parent().prev().remove(),e.resolve(a.data)}}),e.promise()}function l(b){let c=a.Deferred();if(b.has("option").length)return c.reject();if(s.formFields)return c.resolve(s.formFields);let d=o.settings.attributes.form_fields.models,e=1,f="<option value=\"meta\">Meta Data</option>";return a.each(d,function(a){f+="<option value="+d[a].attributes.custom_id+">"+(d[a].attributes.field_label||d[a].attributes.placeholder||"Item #"+e)+"</option>",e++}),s.formFields=f,c.resolve(f)}function m(a,b,c,d){let e=a.closest(".elementor-repeater-fields").find("[data-setting=\"_id\"]").val(),f=o.settings.attributes[b].models.filter(a=>a.attributes._id===e)[0].attributes[c];a.html(d).val(f)}function n(a,b){let c=elementor.getPanelView().getCurrentPageView(),d=c.collection.findWhere({name:a});d.set("options",b);let e=d.cid,f=c.children.findByModelCid(e);f.render()}let o,p,q,r=a(document),s={},t=0,u="";"undefined"!=typeof elementor&&elementor.hooks.addAction("panel/open_editor/widget/form",(a,b,c)=>{o=c.getContainer(),q=c.model.id,p=elementorFrontend.config.post.id}),r.on("click",".elementor_ap_zoho_crm_credentials_validate button",function(i){i.preventDefault();let k=a(this),l=a(".elementor_ap_zoho_crm_client_id input").val(),m=a(".ap_zoho_crm_redirect_uri").text();f(k),b("https://accounts.zoho.com/oauth/v2/auth?access_type=offline&response_type=code&prompt=consent&scope=ZohoCRM.settings.modules.READ,ZohoCRM.settings.fields.read,ZohoCRM.modules.CREATE&client_id="+l+"&redirect_uri="+m).then(function(b){let e=a("[data-setting=\"ap_zoho_crm_credentials_source\"]").val()||"default",f=a(".elementor_ap_zoho_crm_client_secret input").val(),g=c(b,"code"),h=c(b,"accounts-server");return d("ap_zoho_crm_credentials_validate",e,l,f,g,h)},function(){h(k)}).then(function(b){var c=Math.round;try{"success"===b.data?(g(k),t=1):""===b.data.access_token?h(k):(g(k),$e.run("document/elements/settings",{container:o,settings:{ap_zoho_crm_access_token:b.data.access_token,ap_zoho_crm_refresh_token:b.data.refresh_token,ap_zoho_crm_expires_in:c(new Date().getTime()/1e3)+b.data.expires_in,ap_zoho_crm_api_domain:b.data.api_domain,ap_zoho_crm_accounts_server:b.data.accounts_server}}),j(a("[data-setting=\"ap_zoho_crm_module_field\"]"),"custom").then(function(a){n("ap_zoho_crm_module",a)}))}catch(a){h(k)}})}),r.on("change","[data-setting=\"ap_zoho_crm_credentials_source\"]",function(){s.modules=null,s.fields=null,a(".elementor-repeater-row-controls").removeClass("editable");let b=a("[data-setting=\"ap_zoho_crm_module\"]").html(""),c=a(this).val();j(b,c).then(function(a){n("ap_zoho_crm_module",a)})}),r.on("change","[data-setting=\"ap_zoho_crm_module\"]",function(){a(".elementor-repeater-row-controls").removeClass("editable"),s.fields=null,a("[data-setting=\"ap_zoho_crm_module_field\"]").html("")}),r.on("mouseup",".elementor-control-ap_section_zoho_crm",function(){!1===a(this).hasClass("elementor-open")&&(s.formFields=null,i("[data-setting=\"ap_zoho_crm_module\"]").then(b=>{let c=a(b),d=o.settings.attributes.ap_zoho_crm_credentials_source;j(c,d).then(function(a){n("ap_zoho_crm_module",a)})}))}),r.on("mouseup",".elementor-control-ap_zoho_crm_fields_mapping .elementor-repeater-row-item-title",function(){let b=a(this).parent().next().find("[data-setting=\"ap_zoho_crm_module_field\"]"),c=o.settings.attributes.ap_zoho_crm_credentials_source,d=o.settings.attributes.ap_zoho_crm_module;k(b,c,d).then(function(a){m(b,"ap_zoho_crm_fields_mapping","ap_zoho_crm_module_field",a)});let e=a(this).parent().next().find("[data-setting=\"ap_zoho_crm_form_field\"]");l(e).then(function(a){m(e,"ap_zoho_crm_fields_mapping","ap_zoho_crm_form_field",a)})}),r.on("click",".elementor-control-ap_zoho_crm_fields_mapping .elementor-repeater-add",function(){let b=a(this).parent().prev().find("[data-setting=\"ap_zoho_crm_module_field\"]").last(),c=o.settings.attributes.ap_zoho_crm_credentials_source,d=o.settings.attributes.ap_zoho_crm_module;k(b,c,d).then(function(a){m(b,"ap_zoho_crm_fields_mapping","ap_zoho_crm_module_field",a)});let e=a(this).parent().prev().find("[data-setting=\"ap_zoho_crm_form_field\"]").last();l(e).then(function(a){m(e,"ap_zoho_crm_fields_mapping","ap_zoho_crm_form_field",a)})}),r.on("click","#elementor-settings-form  input[name=\"submit\"]",function(){t=0}),window.onbeforeunload=function(){if(1===t)return"New information not saved. Do you wish to leave the page?"},window.apZohoCrmFieldsMappingTitle=function(a){return a.replace(/_/g," ")}})(jQuery);